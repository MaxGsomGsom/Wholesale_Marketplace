@model IEnumerable<Wholesale_Marketplace.Models.Dialog_dispute>
@using Wholesale_Marketplace.Models 


@{
    ViewBag.Title = "Диалоги"; //ошибка если нет сообщений, либо емсли не присвоен продавец, проверить создание диспута
    if (ViewBag.RoleID == 0) { Layout = "~/Views/Shared/BuyerLayout.cshtml"; }
}


<div class="field-main">
    @foreach (Dialog_dispute dialog in Model)
    {
        Message lastMessage = null;
        if (dialog.Messages.Count > 0)
        {
            lastMessage = dialog.Messages.Last();
        }
        <div class="row field-in" style="padding-top:1em; margin-bottom:1em; padding-left:0px">
            @if (dialog.Seller != null)
            {
            <div class="col-md-3">
                <img src="/Account/Avatar?UserID=@dialog.Seller.UserID" class="img-responsive img-rounded" style="width:100%; max-height:100px" />
            </div>
    <div class="col-md-6">
        <div class="row">@dialog.Seller.User.Login (продавец магазина @dialog.Seller.Store.Name)</div>
        <div class="row"></div>
        @if (dialog.Order != null)
        {
            <div class="row">Заказ: <a href="/Order/Info?id=@dialog.OrderID" style="text-decoration:none; color:black"><b>@dialog.OrderID</b></a></div>
        }
        <div class="row"></div>
@if (dialog.Messages.Count > 0)
{
        <div class="row">Последнее сообщение: @lastMessage.Post_date от @lastMessage.User.Login</div>
        <div class="row">@lastMessage.Text</div>
        }
    </div>
            }
            else
            {
                <div class="col-md-3">
                    <img src="/Account/Avatar?UserID=-1" class="img-responsive img-rounded" style="width:100%; max-height:100px" />
                </div>
                <div class="col-md-6">
                    <div class="row">@dialog.Support_agent.User.Login (агент техподдержки)</div>
                    <div class="row"></div>
@if (dialog.Messages.Count > 0) {
                    <div class="row">Последнее сообщение: @lastMessage.Post_date от @lastMessage.User.Login</div>
                    <div class="row">@lastMessage.Text</div>
}
                </div>
             }
                    

            <div class="col-md-3">
                <div class="row" style="padding-bottom:0em"><a class="btn btn-default" href="/Dialog/Show?id=@dialog.DisputeID">Открыть</a></div>
            </div>
        </div>
    }

</div>